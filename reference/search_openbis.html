<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Assemble and execute openBIS search queries — search_openbis • infx</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


<meta property="og:title" content="Assemble and execute openBIS search queries — search_openbis" />

<meta property="og:description" content="Searching in openBIS presents a powerful alternative to iterative listing
and selecting of objects. As an example, in order to find image data sets
associated with an experiment, instead of first listing all experiments,
selecting the one of interest, then listing all plates of that experiment,
followed by listing image data sets for each of the plates, the requested
data sets can be directly retrieved by constructing a search query with
search_criteria() and executing the search by calling search_openbis()." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">infx</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/infx-intro.html">Introduction to infx</a>
    </li>
    <li>
      <a href="../articles/json-class.html">JSON object handling</a>
    </li>
    <li>
      <a href="../articles/openbis-api.html">OpenBIS API coverage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Assemble and execute openBIS search queries</h1>
    
    <div class="hidden name"><code>search_openbis.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Searching in openBIS presents a powerful alternative to iterative listing
and selecting of objects. As an example, in order to find image data sets
associated with an experiment, instead of first listing all experiments,
selecting the one of interest, then listing all plates of that experiment,
followed by listing image data sets for each of the plates, the requested
data sets can be directly retrieved by constructing a search query with
<code>search_criteria()</code> and executing the search by calling <code>search_openbis()</code>.</p>
    
    </div>

    <pre class="usage"><span class='fu'>search_openbis</span>(<span class='no'>token</span>, <span class='no'>criteria</span>, <span class='kw'>target_object</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"data_set"</span>, <span class='st'>"experiment"</span>,
  <span class='st'>"material"</span>, <span class='st'>"sample"</span>), <span class='kw'>fetch_options</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>search_criteria</span>(<span class='no'>...</span>, <span class='kw'>operator</span> <span class='kw'>=</span> <span class='st'>"all"</span>, <span class='kw'>sub_criteria</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>search_sub_criteria</span>(<span class='no'>criteria</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"sample"</span>)

<span class='fu'>property_clause</span>(<span class='no'>property_code</span>, <span class='no'>value</span>, <span class='no'>...</span>)

<span class='fu'>any_property_clause</span>(<span class='no'>value</span>, <span class='no'>...</span>)

<span class='fu'>any_field_clause</span>(<span class='no'>value</span>, <span class='no'>...</span>)

<span class='fu'>attribute_clause</span>(<span class='kw'>attribute</span> <span class='kw'>=</span> <span class='st'>"code"</span>, <span class='no'>value</span>, <span class='no'>...</span>)

<span class='fu'>time_attribute_clause</span>(<span class='kw'>attribute</span> <span class='kw'>=</span> <span class='st'>"registration"</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='fu'>Sys.Date</span>(),
  <span class='kw'>timezone</span> <span class='kw'>=</span> <span class='fl'>0L</span>, <span class='no'>...</span>)

<span class='fu'>list_property_types</span>(<span class='no'>token</span>, <span class='kw'>with_relations</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>token</th>
      <td><p>Login token as created by <code><a href='login.html'>login_openbis()</a></code>.</p></td>
    </tr>
    <tr>
      <th>criteria</th>
      <td><p>A single <code>SearchCriteria</code> object.</p></td>
    </tr>
    <tr>
      <th>target_object</th>
      <td><p>The object type the search is targeted at, i.e.
<code>DataSet</code>s, <code>Experiment</code>s, etc.</p></td>
    </tr>
    <tr>
      <th>fetch_options</th>
      <td><p>If samples are searched for, additional fetch options
can be specified.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>For <code>search_openbis()</code> passed to <code><a href='request.html'>make_request()</a></code>, for
<code>search_criteria()</code> a set of match clause objects, and for match clause
constructors, the comparison mode can be passed as <code>mode</code> argument, which
may be <code>eq</code> (==), <code>lte</code> (&lt;=) or <code>gte</code> (&gt;=).</p></td>
    </tr>
    <tr>
      <th>operator</th>
      <td><p>How to combine search clauses, either <code>all</code> or <code>any</code> have
to be fulfilled.</p></td>
    </tr>
    <tr>
      <th>sub_criteria</th>
      <td><p>Optionally, one or several <code>SearchSubCriteria</code> objects
can be used to create a <code>SearchCriteria</code> object.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>The entity type, a <code>SearchSubCriteria</code> is applied to.</p></td>
    </tr>
    <tr>
      <th>property_code</th>
      <td><p>Code identifying a property to be used for the
comparison.</p></td>
    </tr>
    <tr>
      <th>value</th>
      <td><p>The value used in the comparison.</p></td>
    </tr>
    <tr>
      <th>attribute</th>
      <td><p>Name of the attribute to be used for the comparison.</p></td>
    </tr>
    <tr>
      <th>timezone</th>
      <td><p>A string identifying the timezone of the specified date,
examples include "+1", "-5", "0", etc.</p></td>
    </tr>
    <tr>
      <th>with_relations</th>
      <td><p>Logical switch indicating whether relations should
be returned as well.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Searching openBis can be done by creating a <code>SearchCriteria</code> object and
passing that to <code>search_openbis()</code>, alongside specifying what type of
object is being searched for. In case of <code>Sample</code>s being searched for,
a further argument, <code>fetch_options</code>, can be specified for controlling the
search, which can contain one or more of the strings</p><ul>
<li><p><code>ancestors</code>: Ask for all ancestors.</p></li>
<li><p><code>basic</code>: Samples will have only basic attributes (id, code, type, space
code, experiment identifier, registrator, registration date,
modification date) but no properties.</p></li>
<li><p><code>children</code>: Samples contain also their children samples.</p></li>
<li><p><code>contained</code>: Ask for contained samples.</p></li>
<li><p><code>descendants</code>: Ask for all descendants.</p></li>
<li><p><code>metaprojects</code>: Ask for metaprojects this sample belongs to.</p></li>
<li><p><code>parents</code>: Samples contain also their parent samples.</p></li>
<li><p><code>properties</code>: Samples contain basic attributes and all properties.</p></li>
</ul>
    <p>A <code>SearchCriteria</code> object can be instantiated using the constructor
<code>search_criteria()</code>, which takes one or several match clause objects, a
search operator specifying whether to match <code>all</code> or <code>any</code> clauses, and
optionally one or several <code>SearchSubCriteria</code> objects. <code>SearchSubCriteria</code>
objects in turn can be created with <code>search_sub_criteria()</code>, which takes a
single <code>SearchCriteria</code> object alongside a string specifying the entities,
the sub criterion is applied to. Possibilities are</p><ul>
<li><p><code>data_set_container</code></p></li>
<li><p><code>data_set_parent</code></p></li>
<li><p><code>data_set_child</code></p></li>
<li><p><code>experiment</code></p></li>
<li><p><code>sample</code></p></li>
<li><p><code>sample_container</code></p></li>
<li><p><code>sample_child</code></p></li>
<li><p><code>sample_parent</code></p></li>
</ul>
    <p><code>SearchCriteria</code> objects, used for searching openBis, consist of one or
several match clauses. A match clause, broadly speaking, consist of a
desired value, a field to which this value is compared to and a comparison
operator (e.g. equality). Match clauses can be constructed using any of
<code>attribute_clause()</code>, <code>time_attribute_clause()</code>, <code>property_clause()</code>,
<code>any_property_clause()</code>, and <code>any_field_clause()</code>. Attribute match clauses
have a fixed set of attributes against which the match is performed:</p><ul>
<li><p>time attribute match clauses</p><ul>
<li><p><code>registration_date</code></p></li>
<li><p><code>modification_date</code></p></li>
</ul></li>
<li><p>attribute match clauses</p><ul>
<li><p><code>code</code></p></li>
<li><p><code>type</code></p></li>
<li><p><code>perm_id</code></p></li>
<li><p><code>space</code></p></li>
<li><p><code>project</code></p></li>
<li><p><code>project_perm_id</code></p></li>
<li><p><code>metaproject</code></p></li>
<li><p><code>registrator_user_id</code></p></li>
<li><p><code>registrator_first_name</code></p></li>
<li><p><code>registrator_last_name</code></p></li>
<li><p><code>registrator_email</code></p></li>
<li><p><code>modifier_user_id</code></p></li>
<li><p><code>modifier_first_name</code></p></li>
<li><p><code>modifier_last_name</code></p></li>
<li><p><code>modifier_email</code></p></li>
</ul></li>
</ul>
    <p>In order to determine the possible values that can be supplied to
<code>property_clause()</code> as <code>property_code</code>s, <code>list_property_types()</code> can be
called. This function returns all property types available throughout the
queried openBis instance. As objects of several types
(<code>ControlledVocabularyPropertyType</code> and <code>PropertyType</code>) are returned as
property types by the API, the resulting object is a list with each entry
corresponding to a type and holding a set of object of the respective type.</p>
<p>The comparison operator (default is equality) can be any of the following</p><ul>
<li><p><code>equals</code></p></li>
<li><p><code>less_than_or_equal</code>, with alias <code>lte</code></p></li>
<li><p><code>greater_than_or_equal</code>, with alias <code>gte</code></p></li>
</ul>
    <p>All of the option matching is not case-sensitive and is performed with
<code><a href='http://www.rdocumentation.org/packages/base/topics/match.arg'>base::match.arg()</a></code> and therefore options may be abbreviated (e.g. <code>eq</code>
instead of <code>equals</code>).</p>
    
    <h2 class="hasAnchor" id="openbis"><a class="anchor" href="#openbis"></a>openBIS</h2>

    
    <ul>
<li><p><a href='https://svnsis.ethz.ch/doc/openbis/13.04.0/ch/systemsx/cisd/openbis/generic/shared/api/v1/IGeneralInformationService.html'>IGeneralInformationService:searchForDataSets</a></p></li>
<li><p><a href='https://svnsis.ethz.ch/doc/openbis/13.04.0/ch/systemsx/cisd/openbis/generic/shared/api/v1/IGeneralInformationService.html'>IGeneralInformationService:searchForExperiments</a></p></li>
<li><p><a href='https://svnsis.ethz.ch/doc/openbis/13.04.0/ch/systemsx/cisd/openbis/generic/shared/api/v1/IGeneralInformationService.html'>IGeneralInformationService:searchForMaterials</a></p></li>
<li><p><a href='https://svnsis.ethz.ch/doc/openbis/13.04.0/ch/systemsx/cisd/openbis/generic/shared/api/v1/IGeneralInformationService.html'>IGeneralInformationService:searchForSamples</a></p></li>
</ul>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>  <span class='no'>tok</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='login.html'>login_openbis</a></span>()

  <span class='co'># search for an experiment, e.g. ADENO-AU-K1</span>
  <span class='no'>exp</span> <span class='kw'>&lt;-</span> <span class='fu'>search_openbis</span>(<span class='no'>tok</span>,
                        <span class='fu'>search_criteria</span>(
                          <span class='fu'>property_clause</span>(<span class='st'>"pathogen"</span>, <span class='st'>"Adenovirus"</span>),
                          <span class='fu'>property_clause</span>(<span class='st'>"library"</span>, <span class='st'>"Ambion"</span>),
                          <span class='fu'>property_clause</span>(<span class='st'>"geneset"</span>, <span class='st'>"Kinome"</span>),
                          <span class='fu'>property_clause</span>(<span class='st'>"replicate"</span>, <span class='fl'>1L</span>)
                        ),
                        <span class='kw'>target_object</span> <span class='kw'>=</span> <span class='st'>"experiment"</span>)

  <span class='co'># the same can be achieved using the code attribute</span>
  <span class='fu'>identical</span>(<span class='no'>exp</span>,
            <span class='fu'>search_openbis</span>(<span class='no'>tok</span>,
                           <span class='fu'>search_criteria</span>(
                             <span class='fu'>attribute_clause</span>(<span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"ADENO-AU-K1"</span>)
                           ),
                           <span class='kw'>target_object</span> <span class='kw'>=</span> <span class='st'>"experiment"</span>))</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
  <span class='co'># of using the perm_id attribute</span>
  <span class='fu'>identical</span>(<span class='no'>exp</span>,
            <span class='fu'>search_openbis</span>(<span class='no'>tok</span>,
                           <span class='fu'>search_criteria</span>(
                             <span class='fu'>attribute_clause</span>(<span class='st'>"perm_id"</span>,
                                              <span class='st'>"20111223100933426-318017"</span>)
                           ),
                           <span class='kw'>target_object</span> <span class='kw'>=</span> <span class='st'>"experiment"</span>))</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
  <span class='co'># a search with no matches returns an empty list</span>
  <span class='fu'>search_openbis</span>(<span class='no'>tok</span>,
                 <span class='fu'>search_criteria</span>(<span class='fu'>attribute_clause</span>(<span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"foo_bar"</span>)),
                 <span class='kw'>target_object</span> <span class='kw'>=</span> <span class='st'>"experiment"</span>)</div><div class='output co'>#&gt; list()</div><div class='input'>
  <span class='co'># search using sub-criteria: all plate samples of experiment ADENO-DU-K1</span>
  <span class='no'>sub</span> <span class='kw'>&lt;-</span> <span class='fu'>search_sub_criteria</span>(<span class='fu'>search_criteria</span>(
                               <span class='fu'>attribute_clause</span>(<span class='kw'>value</span> <span class='kw'>=</span> <span class='st'>"ADENO-DU-K1"</span>)
                             ),
                             <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"experiment"</span>)
  <span class='no'>all</span> <span class='kw'>&lt;-</span> <span class='fu'>search_openbis</span>(
    <span class='no'>tok</span>,
    <span class='fu'>search_criteria</span>(
      <span class='fu'>attribute_clause</span>(<span class='st'>"type"</span>, <span class='st'>"PLATE"</span>),
      <span class='kw'>sub_criteria</span> <span class='kw'>=</span> <span class='no'>sub</span>
    ),
    <span class='kw'>target_object</span> <span class='kw'>=</span> <span class='st'>"sample"</span>
  )
  <span class='fu'>length</span>(<span class='fu'><a href='json_vec.html'>as_json_vec</a></span>(<span class='no'>all</span>))</div><div class='output co'>#&gt; [1] 14</div><div class='input'>
  <span class='co'># now only include ADENO-DU-K1 plate samples registered after Feb 1st 2013</span>
  <span class='no'>some</span> <span class='kw'>&lt;-</span> <span class='fu'>search_openbis</span>(
    <span class='no'>tok</span>,
    <span class='fu'>search_criteria</span>(
      <span class='fu'>attribute_clause</span>(<span class='st'>"type"</span>, <span class='st'>"PLATE"</span>),
      <span class='fu'>time_attribute_clause</span>(<span class='kw'>value</span> <span class='kw'>=</span> <span class='fu'>as.Date</span>(<span class='st'>"2013-02-01"</span>), <span class='kw'>mode</span> <span class='kw'>=</span> <span class='st'>"gte"</span>),
      <span class='kw'>sub_criteria</span> <span class='kw'>=</span> <span class='no'>sub</span>
    ),
    <span class='kw'>target_object</span> <span class='kw'>=</span> <span class='st'>"sample"</span>
  )
  <span class='fu'>length</span>(<span class='fu'><a href='json_vec.html'>as_json_vec</a></span>(<span class='no'>some</span>))</div><div class='output co'>#&gt; [1] 1</div><div class='input'>
  <span class='fu'><a href='login.html'>logout_openbis</a></span>(<span class='no'>tok</span>)</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#openbis">openBIS</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='mailto:nicolas.bennett@stat.math.ethz.ch'>Nicolas Bennett</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  docsearch({
    
    
    apiKey: '8f9990194a308dca43109e01826929af',
    indexName: 'infx',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>


  </body>
</html>

